#!/usr/bin/env python
import datetime, os
from subprocess import call
import sys

PROGRAMS = ['ILS_Shrink']

INSTANCES = """warmup, anchors, ranges, backrefs, abba, aman-aplan, prime, four, order,
               triples, glob, balance, powers, long-count, alphabetical""".split(',')

i = int(sys.argv[1]) if len(sys.argv) == 2 else 0

INSTANCES_TO_EXECUTE = [
    INSTANCES[:4],
    INSTANCES[4:8],
    INSTANCES[8:12],
    INSTANCES[12:]
]

SEEDS = [4105328976, 6370951248, 9431657082, 1874029365, 5691784320, 8392760514,
         4612780539, 8261384957, 2463075891, 9135874206, 7095231486, 9842301657,
         2196735084, 9067852413, 2405681973, 2738495106, 1069782534, 3018795246,
         1736058429, 6087432195, 4925731068, 3486027915, 6941372580, 1068243795,
         1764028593, 3857069214, 9125784630, 7914823056, 1258360497, 7965023841]

DEPTHS = [1, 3, 5]

FOLDER_NAME = 'shrink-at-the-end'


for program in PROGRAMS:
    for instance in INSTANCES_TO_EXECUTE[i]:
        instance = instance.strip()
        for depth in DEPTHS:
            for index, seed in enumerate(SEEDS):
                today = datetime.date.today().strftime("%Y-%m-%d")
                resultsDir = FOLDER_NAME
                absResultsDir = "%s/results/%s" % (os.getcwd(), resultsDir)

                if not os.path.isdir(absResultsDir):
                    os.mkdir(absResultsDir)

                absCsvFilePath = "%s/%s.csv" % (absResultsDir, program)
                csvFilePath = "%s/%s.csv" % (resultsDir, program)

                if not os.path.isfile(absCsvFilePath):
                    call(['touch', absCsvFilePath])

                cmd = ["npm", "run", "localsearch", "--",
                       "--name", program,
                       "--instance", instance,
                       "--depth", depth,
                       "--index", index,
                       "--seed", seed,
                       "--log-level", 1,
                       "--csv", csvFilePath]

                cmd = list(map(str, cmd))
                call(cmd, shell=os.name == 'nt')
